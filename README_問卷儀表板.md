# README — 桃園市公車 qrcode 問卷分析儀表板

本專案為單一 HTML 檔的互動式儀表板，透過上傳 Excel 問卷檔快速產生統計圖表、數據表與分析報告。無需後端、開箱即用。

- 檔案位置：`c:\Users\root\Desktop\qrcode問卷儀表板\qrcode問卷儀表板.html`
- 標題顯示：`🚌 桃園市公車乘客滿意度分析系統`

## 功能特色

- 直覺上傳 Excel（.xlsx/.xls）並自動解析
- 核心指標卡：總問卷數、平均滿意度、APP 使用率、每日搭乘率
- 圖表
  - 整體滿意度分布（圓餅/甜甜圈）
  - 填寫時機分析（長條）
  - 搭乘目的統計（橫向長條，Top 10，附資料標籤）
  - 各項滿意度比較（雷達圖，1–5 分平均）
- 篩選與分頁
  - 路線、日期範圍（以「填答時間」解析）、時段（依「搭乘班次」的小時）
  - 表格分頁與每頁筆數（可記憶於 localStorage）
- 匯出報告（Excel）
  - 匯出摘要、整體滿意度分布、各項滿意度平均、路線分析（篩選）、時段分析、填寫時機/搭乘頻率/目的分布、目前篩選資料、原始資料（全部）

## 使用方式

1. 以瀏覽器開啟 `qrcode問卷儀表板.html`。
2. 點擊「📁 上傳Excel檔案」選擇問卷 Excel。
3. 依需求設定「路線 / 日期 / 時段 / 每頁筆數」，按「更新圖表」。
4. 若需導出結果，按「匯出報告」，會產出多工作表的 `.xlsx`。

提示：
- 首次載入時若偵測到 `window.fs.readFile`（特定環境）會嘗試讀取內建範例檔，否則請手動上傳。
- 分頁筆數設定保存在瀏覽器 localStorage。

## Excel 欄位需求

請確認 Excel 的欄位名稱與下列鍵值一致（至少需要以下常用欄位；滿意度欄位影響圖表與平均計算）：

- 基本欄位
  - `填答時間`
  - `您本次的搭乘路線`
  - `您本次掃描QR CODE的站位名稱`
  - `您本次的搭乘班次`
  - `您搭乘公車的目的`（如有「其他-...」會合併為「其他」）
  - `您搭乘公車的頻率`（用於每日搭乘率）
  - `您本次乘車是否有使用官方「桃園公車」APP？`（有使用/未使用）
  - `其他建議`
  - `請問您在何時填寫本問卷`（填寫時機）

- 滿意度欄位（1–5 級文字）
  - `請問您對於以下項目的滿意度 - (1)預估到站時間`
  - `請問您對於以下項目的滿意度 - (2)候車設施(站牌、座椅)情形`
  - `請問您對於以下項目的滿意度 - (3)候車環境整潔情形`
  - `請問您對於以下項目的滿意度 - (4)車輛整潔情形`
  - `請問您對於以下項目的滿意度 - (5)駕駛員服務態度`
  - `請問您對於以下項目的滿意度 - (6)整體滿意度`

可接受的滿意度值：`非常滿意`、`滿意`、`普通`、`不滿意`、`非常不滿意`

備註：
- 匯出報告中的「各項滿意度平均」會以當前版本程式內建的一組指標名稱匯總；若您的資料使用上列 6 項欄位，平均值可正常計算。

## 技術棧

- Chart.js 3.9.1（圖表）
- chartjs-plugin-datalabels 2.2.0（資料標籤）
- SheetJS xlsx 0.18.5（Excel 讀寫）
- html2canvas 1.4.1、jsPDF 2.5.1、html2pdf.js 0.10.1（目前主要用於前置，報告以 xlsx 為主）
- 純前端，透過 CDN 載入，無需伺服器

CDN 已於 `head` 中以 `<script>` 引入，需連網使用。

## 運作細節

- 平均滿意度：將上列文字分數映射為 1–5，計算平均後換算百分比或保留 1–5 分。
- 日期篩選：以 `填答時間` 嘗試解析（支援「yyyy/M/d」、「yyyy-M-d」、含上午/下午字樣等），比對 `startDate` ~ `endDate`。
- 時段篩選：從 `您本次的搭乘班次` 取小時（06–12 上午、12–18 下午、其餘視為晚上）。
- 表格渲染：同步套用篩選與分頁，顯示主要欄位並以顏色膠囊標示整體滿意度。

## 匯出報告（XLSX）

按「匯出報告」後生成檔名：
`桃園市公車滿意度_分析報告_YYYY-MM-DD-HH-MM-SS.xlsx`

包含工作表：
- 匯出摘要（當前篩選、整體概覽、篩選概覽）
- 整體滿意度分布（全部/篩選，含占比）
- 各項滿意度平均（全部/篩選）
- 路線分析（篩選）
- 時段分析（桶：上午/下午/晚上/未填）
- 填寫時機分布、搭乘頻率分布、搭乘目的分布（全部/篩選）
- 目前篩選資料、原始資料(全部)

## 常見問題

- 無法載入圖表：請確認可連線至 CDN，或自行改為本機託管資源。
- 沒有資料或圖表為 0：請確認欄位名稱與上述需求完全一致（包含括號、全形/半形）。
- 日期篩選無效：請檢查 `填答時間` 格式；若格式特殊，建議先在 Excel 中轉為標準日期字串。

## 隱私與資料

- 所有處理皆在瀏覽器端進行，資料不會上傳至伺服器。
- 匯出的 Excel 檔於本機下載，請自行妥善保存。

## 開發者筆記

- 主要程式碼位於同一檔案內的 `<script>` 區塊，核心函式：
  - `handleFileUpload()`：載入 Excel
  - `processData()`：驅動統計卡、篩選、圖表、表格
  - `initCharts()`、`updateCharts()`：初始化與更新圖表
  - `getFilteredData()`、`updateDataTable()`：篩選與分頁呈現
  - `exportReport()`：產生多工作表 Excel
- 若需離線使用，請改用本機版資源或自建簡易靜態伺服器，並將 CDN 改為相對路徑檔案。
